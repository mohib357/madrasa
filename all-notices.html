<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>সকল নোটিশ</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body class="bg-white">

  <section class="py-16">
    <div class="container mx-auto px-4">
      <h2 class="text-4xl font-bold text-center text-green-900 mb-12">নোটিশ বোর্ড</h2>
      <div class="max-w-4xl mx-auto">
        <div id="notice-container">
          <p class="text-center text-gray-600">নোটিশ লোড হচ্ছে...</p>
        </div>
      </div>
    </div>
  </section>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const noticeContainer = document.getElementById('notice-container');
      const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRFpVqdRkkAhEvrJeTmioOx987QpCAeQlCjwRKZD_D_SjwdYZLBptKPxSpNsAPP5e-_DimfaYYUR0CK/pub?output=csv';

      fetch(sheetURL)
        .then(response => {
          if (!response.ok) throw new Error('Network issue');
          return response.text();
        })
        .then(data => {
          processNotices(data);
        })
        .catch(error => {
          noticeContainer.innerHTML = '<p class="text-center text-red-500">নোটিশ লোড করা সম্ভব হয়নি।</p>';
        });

      function parseCSV(text) {
        const rows = [];
        let currentRow = [], currentField = '', inQuotes = false;

        for (let i = 0; i < text.length; i++) {
          const char = text[i];
          if (char === '"') {
            inQuotes = !inQuotes || text[i + 1] === '"';
            if (text[i + 1] === '"') i++;
          } else if (char === ',' && !inQuotes) {
            currentRow.push(currentField);
            currentField = '';
          } else if (char === '\n' && !inQuotes) {
            currentRow.push(currentField);
            rows.push(currentRow);
            currentRow = [];
            currentField = '';
          } else {
            currentField += char;
          }
        }
        if (currentField || currentRow.length) {
          currentRow.push(currentField);
          rows.push(currentRow);
        }
        return rows;
      }

      function processNotices(data) {
        noticeContainer.innerHTML = '';
        const rows = parseCSV(data);
        if (rows.length <= 1) {
          noticeContainer.innerHTML = '<p class="text-center text-gray-600">কোনো নোটিশ পাওয়া যায়নি।</p>';
          return;
        }

        const notices = [];
        for (let i = 1; i < rows.length; i++) {
          const [date, title, description, status] = rows[i];
          if (status?.trim().toLowerCase() === 'show') {
            notices.push({ date: date.trim(), title: title.trim(), description: description.trim() });
          }
        }

        notices.reverse();

        if (!notices.length) {
          noticeContainer.innerHTML = '<p class="text-center text-gray-600">কোনো নোটিশ পাওয়া যায়নি।</p>';
          return;
        }

        notices.forEach(notice => {
          const shortDescription = notice.description.length > 100
            ? notice.description.substring(0, 100) + '...'
            : notice.description;

          const noticeCard = `
            <div class="bg-green-50 rounded-lg p-6 mb-4 hover:shadow-lg transition cursor-pointer notice-card" 
                 data-full-description="${encodeURIComponent(notice.description)}"
                 data-title="${encodeURIComponent(notice.title)}"
                 data-date="${encodeURIComponent(notice.date)}">
              <div class="flex justify-between items-start flex-col sm:flex-row">
                <div class="flex-1">
                  <h3 class="text-lg font-semibold text-green-800">${notice.title}</h3>
                  <p class="text-gray-600 mt-1 notice-short-description">${shortDescription}</p>
                </div>
                <span class="text-sm text-gray-500 mt-2 sm:mt-0 sm:ml-4">${notice.date}</span>
              </div>
            </div>
          `;
          noticeContainer.innerHTML += noticeCard;
        });

        document.querySelectorAll('.notice-card').forEach(card => {
          card.addEventListener('click', function () {
            const title = decodeURIComponent(this.getAttribute('data-title'));
            const fullDescription = decodeURIComponent(this.getAttribute('data-full-description'));
            const date = decodeURIComponent(this.getAttribute('data-date'));

            const popup = document.createElement('div');
            popup.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            popup.innerHTML = `
              <div class="bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="flex justify-between items-start mb-4">
                  <h3 class="text-xl font-bold text-green-800">${title}</h3>
                  <button class="close-popup text-gray-500 hover:text-gray-700"><i class="fas fa-times text-xl"></i></button>
                </div>
                <p class="text-gray-600 mb-2">${date}</p>
                <p class="text-gray-700 whitespace-pre-line">${fullDescription.replace(/\n/g, '<br>')}</p>
              </div>
            `;
            document.body.appendChild(popup);

            popup.addEventListener('click', function (e) {
              if (e.target === popup || e.target.classList.contains('close-popup') || e.target.classList.contains('fa-times')) {
                document.body.removeChild(popup);
              }
            });
          });
        });
      }
    });
  </script>
  <script>
document.getElementById('view-all-notices').addEventListener('click', function(e) {
  e.preventDefault();
  
  // পপআপ তৈরি করা
  const popup = document.createElement('div');
  popup.className = 'fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 overflow-y-auto';
  popup.innerHTML = `
    <div class="bg-white rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto relative">
      <div class="flex justify-between items-center mb-6">
        <h3 class="text-2xl font-bold text-green-800">সকল নোটিশ</h3>
        <button class="close-popup text-gray-500 hover:text-gray-700 text-2xl">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div id="all-notices-container">
        <div class="flex justify-center items-center py-8">
          <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-green-700"></div>
        </div>
      </div>
    </div>
  `;
  
  document.body.appendChild(popup);
  
  // বডির স্ক্রলিং বন্ধ করা
  document.body.style.overflow = 'hidden';
  
  // পপআপ বন্ধ করার ফাংশন
  function closePopup() {
    document.body.removeChild(popup);
    document.body.style.overflow = 'auto';
  }
  
  // ক্লোজ বাটনে ক্লিক করলে পপআপ বন্ধ হবে
  popup.querySelector('.close-popup').addEventListener('click', closePopup);
  
  // পপআপের বাইরে ক্লিক করলে পপআপ বন্ধ হবে
  popup.addEventListener('click', function(e) {
    if (e.target === popup) {
      closePopup();
    }
  });
  
  // সকল নোটিশ লোড করা
  const allNoticesContainer = popup.querySelector('#all-notices-container');
  
  // Test Data
  const testData = `তারিখ,শিরোনাম,বিবরণ,Status
          "০৩ আগষ্ট, ২০২৫","১ম সাময়িক পরীক্ষার বন্ধের তারিখ","আগামী ৯ আগষ্ট থেকে ১ম সাময়িক পরীক্ষার বন্ধ শুরু হবে। সকল শিক্ষার্থীকে পরীক্ষার প্রস্তুতি নেওয়ার অনুরোধ করা হলো।",show
          "১০ নভেম্বর, ২০২৩","নতুন ভর্তির বিজ্ঞপ্তি","২০২৪ শিক্ষাবর্ষে ভর্তি শুরু হয়েছে। আগ্রহী ছাত্র-ছাত্রীদের অফিস থেকে ভর্তি ফরম সংগ্রহ করতে হবে।",show
          "০৫ নভেম্বর, ২০২৩","শীতকালীন ছুটির নোটিশ","আগামী ২০শে ডিসেম্বর থেকে ৫ই জানুয়ারি পর্যন্ত শীতকালীন ছুটি থাকবে।",show
          "১৫ অক্টোবর, ২০২৩","বার্ষিক মিলাদ মাহফিল","আগামী ২৫শে অক্টোবর বাদ এশা বার্ষিক মিলাদ মাহফিল অনুষ্ঠিত হবে। সকলকে উপস্থিত থাকার জন্য অনুরোধ করা হলো।",show
          "২০ সেপ্টেম্বর, ২০২৩","শিক্ষক নিয়োগ বিজ্ঞপ্তি","মাদরাসায় শূন্যপদে শিক্ষক নিয়োগ দেওয়া হবে। আগ্রহী প্রার্থীদের আবেদনপত্র জমা দেওয়ার জন্য অনুরোধ করা হলো।",show`;
  
  // true for test data, false for Google Sheet Data
  const useTestData = false;
  
  if (useTestData) {
    processAllNotices(testData);
  } else {
    // Google Sheets লিংক
    const sheetURL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRFpVqdRkkAhEvrJeTmioOx987QpCAeQlCjwRKZD_D_SjwdYZLBptKPxSpNsAPP5e-_DimfaYYUR0CK/pub?output=csv';
    
    fetch(sheetURL)
      .then(response => {
        if (!response.ok) {
          throw new Error('Network response was not ok');
        }
        return response.text();
      })
      .then(data => {
        processAllNotices(data);
      })
      .catch(error => {
        console.error('Error fetching notices:', error);
        allNoticesContainer.innerHTML = '<p class="text-center text-red-500">নোটিশ লোড করা সম্ভব হয়নি।</p>';
      });
  }
  
  function processAllNotices(data) {
    allNoticesContainer.innerHTML = '';
    
    // CSV parsing functions
    function parseCSV(text) {
      const rows = [];
      let currentRow = [];
      let currentField = '';
      let inQuotes = false;
      let quoteChar = '"';
      
      for (let i = 0; i < text.length; i++) {
        const char = text[i];
        
        if (char === quoteChar) {
          if (inQuotes && text[i + 1] === quoteChar) {
            // Escaped quote
            currentField += quoteChar;
            i++;
          } else {
            inQuotes = !inQuotes;
          }
        } else if (char === ',' && !inQuotes) {
          // End of field
          currentRow.push(currentField);
          currentField = '';
        } else if (char === '\n' && !inQuotes) {
          // End of row
          currentRow.push(currentField);
          rows.push(currentRow);
          currentRow = [];
          currentField = '';
        } else {
          currentField += char;
        }
      }
      
      // Add last row if any
      if (currentField !== '' || currentRow.length > 0) {
        currentRow.push(currentField);
        rows.push(currentRow);
      }
      
      return rows;
    }
    
    const rows = parseCSV(data);
    
    if (rows.length <= 1) {
      allNoticesContainer.innerHTML = '<p class="text-center text-gray-600">কোনো নোটিশ পাওয়া যায়নি।</p>';
      return;
    }
    
    // Keeping all notices in an array
    const notices = [];
    const headers = rows[0].map(h => h.trim().toLowerCase());
    
    // The first row is a header, so it is being omitted
    for (let i = 1; i < rows.length; i++) {
      const row = rows[i];
      
      // Make sure there are at least 4 columns (including the Status column)
      if (row.length >= 4) {
        const noticeDate = row[0].trim();
        const noticeTitle = row[1].trim();
        const noticeDescription = row[2].trim();
        const noticeStatus = row[3].trim().toLowerCase();
        
        // Only notices marked "show" are being retrieved
        if (noticeStatus === 'show') {
          notices.push({
            date: noticeDate,
            title: noticeTitle,
            description: noticeDescription
          });
        }
      }
    }
    
    // Notices are being sorted in reverse order (bottom to top)
    notices.reverse();
    
    if (notices.length === 0) {
      allNoticesContainer.innerHTML = '<p class="text-center text-gray-600">কোনো নোটিশ পাওয়া যায়নি।</p>';
      return;
    }
    
    // Display all notices
    notices.forEach(notice => {
      const noticeCard = `
        <div class="bg-green-50 rounded-lg p-6 mb-4 hover:shadow-lg transition">
          <div class="flex justify-between items-start flex-col sm:flex-row">
            <div class="flex-1">
              <h3 class="text-lg font-semibold text-green-800">${notice.title}</h3>
              <p class="text-gray-700 mt-2">${notice.description}</p>
            </div>
            <span class="text-sm text-gray-500 mt-2 sm:mt-0 sm:ml-4 whitespace-nowrap">${notice.date}</span>
          </div>
        </div>
      `;
      
      allNoticesContainer.innerHTML += noticeCard;
    });
  }
});
</script>
</body>
</html>
